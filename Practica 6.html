<!DOCTYPE HTML>
<html>
<head>
  <style>
    html, body {
      width:  100%;
      height: 100%;
      margin: 0px;
      border: 0;
      overflow: hidden;
      display: block;
    }
    #gui {
      position: absolute;
      top: 0;
      left: 0;
    }
    /* Estilos del menú agregado */
    #menuAnim {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      padding: 10px;
      border-radius: 8px;
      font-family: sans-serif;
      z-index: 200;
    }
    #menuAnim select, #menuAnim button {
      margin-top: 6px;
      width: 160px;
    }
  </style>    
  <title>Cubos Interactivos WebGL 2.0</title>
  <meta charset="UTF-8">
</head>
<body>
  <canvas id="webglcanvas"></canvas>

  <!-- ======= MENÚ AGREGADO (no toca nada del WebGL) ======= -->
  <div id="menuAnim">
    <div>
      <label for="selectorLetra">Letra a animar</label><br>
      <select id="selectorLetra">
        <option value="todas">Todas</option>
        <option value="C">C</option>
        <option value="P">P</option>
        <option value="E">E</option>
      </select>
    </div>
    <div style="margin-top:8px;">
      <label for="selectorAnim">Animación</label><br>
      <select id="selectorAnim">
        <option value="none">Ninguna</option>
        <option value="rotar">Rotar</option>
        <option value="latido">Latido</option>
        <option value="rebote">Rebote</option>
        <option value="temblor">Temblor</option>
        <option value="onda">Onda</option>
      </select>
    </div>
    <div style="margin-top:8px;">
      <button id="wireframeBtn">malla de triangulos</button>
    </div>
  </div>
  <!-- ====================================================== -->

  <script id="vs" type="vertex">
    #version 300 es
    uniform mat4 uMatrizProyeccion;
    uniform mat4 uMatrizVista;
    uniform mat4 uMatrizModelo;
    layout(location = 0) in vec3 aVertices;
    layout(location = 1) in vec4 aColores;
    out vec4 vColores;
    void main() {
      vColores = aColores;  
      gl_Position = uMatrizProyeccion * uMatrizVista * uMatrizModelo * vec4(aVertices, 1.0);
    }
  </script>

  <script id="fs" type="fragment">
    #version 300 es
    precision highp float;
    in vec4 vColores;
    out vec4 color;
    void main() {
      color = vColores;
    }
  </script>

  <script>
    "use strict";

    /* =================== FUNCIONES MATRICIALES =================== */
    function toRadians(grados) { return grados * Math.PI / 180; }

    function identidad(r) {
      r[0]=1;r[1]=0;r[2]=0;r[3]=0;
      r[4]=0;r[5]=1;r[6]=0;r[7]=0;
      r[8]=0;r[9]=0;r[10]=1;r[11]=0;
      r[12]=0;r[13]=0;r[14]=0;r[15]=1;
    }

    function traslacion(matriz, tx, ty, tz) {
      let r = new Array(16);
      r[0]=1;r[4]=0;r[8]=0;r[12]=tx;
      r[1]=0;r[5]=1;r[9]=0;r[13]=ty;
      r[2]=0;r[6]=0;r[10]=1;r[14]=tz;
      r[3]=0;r[7]=0;r[11]=0;r[15]=1;
      multiplica(matriz, matriz, r);
    }

    function escalacion(matriz, sx, sy, sz) { 
      let r = new Array(16);
      r[0]=sx;r[4]=0;r[8]=0;r[12]=0;
      r[1]=0;r[5]=sy;r[9]=0;r[13]=0;
      r[2]=0;r[6]=0;r[10]=sz;r[14]=0;
      r[3]=0;r[7]=0;r[11]=0;r[15]=1;
      multiplica(matriz, matriz, r);
    }

    function rotacionX(matriz, theta){
      let r = new Array(16);
      let c=Math.cos(toRadians(theta));
      let s=Math.sin(toRadians(theta));
      r[0]=1;r[4]=0;r[8]=0;r[12]=0;
      r[1]=0;r[5]=c;r[9]=-s;r[13]=0;
      r[2]=0;r[6]=s;r[10]=c;r[14]=0;
      r[3]=0;r[7]=0;r[11]=0;r[15]=1;
      multiplica(matriz, matriz, r); 
    }

    function rotacionY(matriz, theta){
      let r = new Array(16);
      let c=Math.cos(toRadians(theta));
      let s=Math.sin(toRadians(theta));
      r[0]=c;r[4]=0;r[8]=s;r[12]=0;
      r[1]=0;r[5]=1;r[9]=0;r[13]=0;
      r[2]=-s;r[6]=0;r[10]=c;r[14]=0;
      r[3]=0;r[7]=0;r[11]=0;r[15]=1;
      multiplica(matriz, matriz, r);
    }

    // rotacionZ — pequeña utilidad que no existía antes (no toca lo tuyo)
    function rotacionZ(matriz, theta){
      let r = new Array(16);
      let c=Math.cos(toRadians(theta));
      let s=Math.sin(toRadians(theta));
      r[0]=c;r[4]=-s;r[8]=0;r[12]=0;
      r[1]=s;r[5]=c;r[9]=0;r[13]=0;
      r[2]=0;r[6]=0;r[10]=1;r[14]=0;
      r[3]=0;r[7]=0;r[11]=0;r[15]=1;
      multiplica(matriz, matriz, r);
    }

    function ortho(r, izq, der, abj, arr, cerca, lejos){
      r[0] = 2/(der-izq); r[4]=0; r[8]=0; r[12]=-(der+izq)/(der-izq);
      r[1]=0; r[5]=2/(arr-abj); r[9]=0; r[13]=-(arr+abj)/(arr-abj);
      r[2]=0; r[6]=0; r[10]=-2/(lejos-cerca); r[14]=-(lejos+cerca)/(lejos-cerca);
      r[3]=0; r[7]=0; r[11]=0; r[15]=1;
    }

    function multiplica(c,a,b){
      let r=new Array(16);
      for(let i=0;i<4;i++){
        for(let j=0;j<4;j++){
          let s=0;
          for(let k=0;k<4;k++) s+=a[i+k*4]*b[k+j*4];
          r[i+j*4]=s;
        }
      }
      for(let i=0;i<16;i++) c[i]=r[i];
    }

    /* =================== VARIABLES GLOBALES (TU CÓDIGO INTACTO) =================== */
    let gl, canvas, programaID, cuboVAO;
    let uMatrizProyeccion, uMatrizVista, uMatrizModelo;
    let MatrizProyeccion=new Array(16), MatrizVista=new Array(16), MatrizModelo=new Array(16);

    // Rotaciones cubos
    let rotX=0, rotY=0;   // P
    let rotX1=0, rotY1=0; // C
    let rotX2=0, rotY2=0; // E
    let rotX3=0, rotY3=0; // R
    let rotX4=0, rotY4=0; // Y
    let antX=0, antY=0;
    let boton_izq_presionado=false;
    let controlLado=0; // 0=izq, 1=der

    /* ========== variables del menú (AGREGADAS) ========== */
    let letraObjetivo = "todas";   // "todas", "C", "P", "E"
    let animacion = "none";        // "none","rotar","latido","rebote","temblor","onda"
    let wireframe = false;
    let tiempoAnim = 0;

    /* =================== EVENTOS MOUSE =================== */
    function mouseDown(event){
      let posx=0,posy=0;
      if(event.x!==undefined && event.y!==undefined){ posx=event.x; posy=event.y; }
      else { posx=event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
             posy=event.clientY + document.body.scrollTop + document.documentElement.scrollTop; }
      posx -= canvas.offsetLeft;
      posy -= canvas.offsetTop;

      //controlLado = (posx < canvas.width/3) ? 0 : 1;
      let tercio_ancho = canvas.width / 3;
      if (posx < tercio_ancho) {
        controlLado = 0; // Primera división (rotX/rotY)
      } else if (posx < 2 * tercio_ancho) {
        controlLado = 2; // Segunda división (rotX2/rotY2) -> Se usa el índice 2 para la E
      } else {
        controlLado = 1; // Tercera división (rotX1/rotY1) -> Se usa el índice 1 para la C
      }
      //------------------------
      antX = posx; antY = posy;
      boton_izq_presionado = true;
    }

    function mouseUp(event){ boton_izq_presionado=false; }

    function mouseMove(event){
      if(!boton_izq_presionado) return;
      let posx=0,posy=0;
      if(event.x!==undefined && event.y!==undefined){ posx=event.x; posy=event.y; }
      else { posx=event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
             posy=event.clientY + document.body.scrollTop + document.documentElement.scrollTop; }
      posx -= canvas.offsetLeft;
      posy -= canvas.offsetTop;

      let dx = posx - antX;
      let dy = posy - antY;

      if (controlLado === 0) {
          rotX += dx * 0.5;
          rotY += dy * 0.5;
      } else if (controlLado === 1) { // Condición para la segunda división
          rotX1 += dx * 0.5;
          rotY1 += dy * 0.5;
      } else if (controlLado === 2) { // Condición para la tercera división
          rotX2 += dx * 0.5;
          rotY2 += dy * 0.5;
      }

      antX = posx; antY = posy;
    }

    /* =================== DIBUJO =================== */
    function dibuja(){
      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

      // aplicar animaciones leves antes de dibujar
      aplicarAnimaciones();

      // C 
      identidad(MatrizModelo);
      traslacion(MatrizModelo,2,0,0);
      rotacionY(MatrizModelo, rotX1);
      rotacionX(MatrizModelo, rotY1);
      escalacion(MatrizModelo, 0.3,0.3,0.3);
      gl.uniformMatrix4fv(uMatrizModelo,false,MatrizModelo);
      gl.bindVertexArray(cuboVAO);
      {
        let mode = wireframe ? gl.LINES : gl.TRIANGLES;
        gl.drawElements(mode,84,gl.UNSIGNED_SHORT,0);
      }

      // P
      identidad(MatrizModelo);
      traslacion(MatrizModelo,-2,0,0);
      rotacionY(MatrizModelo, rotX);
      rotacionX(MatrizModelo, rotY);
      escalacion(MatrizModelo, 0.3,0.3,0.3);
      gl.uniformMatrix4fv(uMatrizModelo,false,MatrizModelo);
      {
        let mode = wireframe ? gl.LINES : gl.TRIANGLES;
        gl.drawElements(mode,108,gl.UNSIGNED_SHORT,84*2);
      }

      // E
      identidad(MatrizModelo);
      traslacion(MatrizModelo,0,0,0);
      rotacionY(MatrizModelo, rotX2);
      rotacionX(MatrizModelo, rotY2);
      escalacion(MatrizModelo, 0.3,0.3,0.3);
      gl.uniformMatrix4fv(uMatrizModelo,false,MatrizModelo);
      gl.bindVertexArray(cuboVAO);
      {
        let mode = wireframe ? gl.LINES : gl.TRIANGLES;
        gl.drawElements(mode,120,gl.UNSIGNED_SHORT,192*2);
      }

      requestAnimationFrame(dibuja);
    }

    /* ========== FUNCIONES DE ANIMACIÓN (AGREGADAS, NO ROMPEN NADA) ========== */
    function aplicarAnimaciones(){
      // tiempo acumulado
      tiempoAnim += 0.02;

      // El efecto para letras seleccionadas
      function aplicaA(letra, fn){
        if (letraObjetivo === "todas" || letraObjetivo === letra) fn();
      }

      switch(animacion){
        case "rotar":
          aplicaA("C", ()=>{ rotX1 += 0.4; rotY1 += 0.4; });
          aplicaA("P", ()=>{ rotX += 0.4; rotY += 0.4; });
          aplicaA("E", ()=>{ rotX2 += 0.4; rotY2 += 0.4; });
          break;

        case "latido":
          let s = 1 + Math.sin(tiempoAnim * 4) * 0.12;
          aplicaA("C", ()=>{ rotX1 += Math.sin(tiempoAnim*6)*0.6; });
          aplicaA("P", ()=>{ rotX += Math.sin(tiempoAnim*6)*0.6; });
          aplicaA("E", ()=>{ rotX2 += Math.sin(tiempoAnim*6)*0.6; });
          break;

        case "rebote":
          aplicaA("C", ()=>{ rotY1 += Math.sin(tiempoAnim*3)*0.9; });
          aplicaA("P", ()=>{ rotY += Math.sin(tiempoAnim*3 + 0.8)*0.9; });
          aplicaA("E", ()=>{ rotY2 += Math.sin(tiempoAnim*3 + 1.6)*0.9; });
          break;

        case "temblor":
          aplicaA("C", ()=>{ rotX1 += (Math.random()-0.5)*2.0; rotY1 += (Math.random()-0.5)*2.0; });
          aplicaA("P", ()=>{ rotX += (Math.random()-0.5)*2.0; rotY += (Math.random()-0.5)*2.0; });
          aplicaA("E", ()=>{ rotX2 += (Math.random()-0.5)*2.0; rotY2 += (Math.random()-0.5)*2.0; });
          break;

        case "onda":
          // fase distinta por letra
          aplicaA("C", ()=>{ rotY1 += Math.sin(tiempoAnim*2 + 0.0) * 1.2; });
          aplicaA("P", ()=>{ rotY += Math.sin(tiempoAnim*2 + 1.5) * 1.2; });
          aplicaA("E", ()=>{ rotY2 += Math.sin(tiempoAnim*2 + 3.0) * 1.2; });
          break;

        case "none":
        default:
          // no hace nada
          break;
      }
    }

    /* =================== MAIN =================== */
    function main(){
      canvas = document.getElementById("webglcanvas");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      gl = canvas.getContext("webgl2");
      if(!gl){ alert("WebGL 2.0 no disponible"); return; }

      // ------ listeners mouse ------
      canvas.addEventListener("mousedown", mouseDown,false);
      canvas.addEventListener("mouseup", mouseUp,false);
      canvas.addEventListener("mouseout", mouseUp,false);
      canvas.addEventListener("mousemove", mouseMove,false);

      gl.viewport(0,0,canvas.width,canvas.height);

      let shaderV = gl.createShader(gl.VERTEX_SHADER);
      gl.shaderSource(shaderV, document.getElementById("vs").text.trim());
      gl.compileShader(shaderV);
      if(!gl.getShaderParameter(shaderV, gl.COMPILE_STATUS)) console.error("VS:",gl.getShaderInfoLog(shaderV));

      let shaderF = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(shaderF, document.getElementById("fs").text.trim());
      gl.compileShader(shaderF);
      if(!gl.getShaderParameter(shaderF, gl.COMPILE_STATUS)) console.error("FS:",gl.getShaderInfoLog(shaderF));

      programaID = gl.createProgram();
      gl.attachShader(programaID, shaderV);
      gl.attachShader(programaID, shaderF);
      gl.linkProgram(programaID);
      if(!gl.getProgramParameter(programaID, gl.LINK_STATUS)) console.error("PROG:",gl.getProgramInfoLog(programaID));
      gl.useProgram(programaID);

      uMatrizProyeccion = gl.getUniformLocation(programaID,"uMatrizProyeccion");
      uMatrizVista = gl.getUniformLocation(programaID,"uMatrizVista");
      uMatrizModelo = gl.getUniformLocation(programaID,"uMatrizModelo");

      /* =================== GEOMETRÍA =================== */
      let vertices=[
        // Letra C
        // A    B      C        D      E       F       G       H
        0,3,1, 3,3,1, 3,2,1, 1,2,1, 1,-2,1, 3,-2,1, 3,-3,1, 0,-3,1,// Frente
        0,3,0, 3,3,0, 3,2,0, 1,2,0, 1,-2,0, 3,-2,0, 3,-3,0, 0,-3,0, // Atrás
        0,3,1, 0,3,0, 0,-3,1, 0,-3,0, // Izq
        3,3,1, 3,3,0, 3,2,1, 3,2,0, 1,2,1, 1,2,0, 1,-2,1, 1,-2,0, 3,-2,1, 3,-2,0, 3,-3,1, 3,-3,0,  // Der 31
        0,-3,1, 0,-3,0, 3,-3,1, 3,-3,0, 3,2,1, 3,2,0, 1,2,1, 1,2,0, // Abajo 39
        0,3,1, 0,3,0, 3,3,1, 3,3,0, 1,-2,1, 1,-2,0, 3,-2,1, 3,-2,0,  // Arriba 0-47

        // Letra P
        // A    B      C        D      E       F       G       H      I      J
        0,3,1, 3,3,1, 3,0,1, 1,0,1, 1,-3,1, 0,-3,1, 1,2,1,  2,2,1,  2,1,1, 1,1,1,// Frente 57
        0,3,0, 3,3,0, 3,0,0, 1,0,0, 1,-3,0, 0,-3,0, 1,2,0,  2,2,0,  2,1,0, 1,1,0,  // Atrás 67
        0,3,1, 0,3,0, 0,-3,1, 0,-3,0, 2,2,1, 2,2,0, 2,1,1, 2,1,0, // Izq 75
        3,3,1, 3,3,0, 3,0,1, 3,0,0, 1,0,1, 1,0,0, 1,-3,1, 1,-3,0, 1,2,1, 1,2,0, 1,1,1, 1,1,0,  // Der 87
        0,-3,1, 0,-3,0, 1,-3,1, 1,-3,0, 3,0,1, 3,0,0, 1,0,1, 1,0,0, 1,2,1, 1,2,0, 2,2,1, 2,2,0, // Abajo 99
        0,3,1, 0,3,0, 3,3,1, 3,3,0, 2,1,1, 2,1,0, 1,1,1, 1,1,0,  // Arriba 107
        // Letra E
        // A     B      C       D      E       F          G         H        I       J       K       L      
        0,3,1, 3,3,1, 3,2,1, 1,2,1, 1,0.5,1, 2,0.5,1, 2,-0.5,1, 1,-0.5,1, 1,-2,1, 3,-2,1, 3,-3,1, 0,-3,1,// Frente 119
        0,3,0, 3,3,0, 3,2,0, 1,2,0, 1,0.5,0, 2,0.5,0, 2,-0.5,0, 1,-0.5,0, 1,-2,0, 3,-2,0, 3,-3,0, 0,-3,0, // Atrás 131
        0,3,1, 0,3,0, 0,-3,1, 0,-3,0, // Izq 135
        3,3,1, 3,3,0, 3,2,1, 3,2,0, 1,2,1, 1,2,0, 1,0.5,1, 1,0.5,0, 2,0.5,1, 2,0.5,0, 2,-0.5,1, 2,-0.5,0, 1,-0.5,1, 1,-0.5,0, 1,-2,1, 1,-2,0, 3,-2,1, 3,-2,0, 3,-3,1, 3,-3,0,  // Der 155
        0,-3,1, 0,-3,0, 3,-3,1, 3,-3,0,    2,-0.5,1, 2,-0.5,0, 1,-0.5,1, 1,-0.5,0,   3,2,1, 3,2,0, 1,2,1, 1,2,0, // Abajo 167
        0,3,1, 0,3,0, 3,3,1, 3,3,0,    1,0.5,1, 1,0.5,0, 2,0.5,1, 2,0.5,0,    1,-2,1, 1,-2,0, 3,-2,1, 3,-2,0,  // Arriba 179

      ];

      let colores=[
        //Letra C
        1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1,    // Frente
        1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1,  // Atrás
        0,1,1,1, 0,1,1,1, 0,1,1,1, 0,1,1,1,   // Izq
        1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1,  // Der
        0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1,  // Abajo
        0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1,    // Arriba

        // Letra P
        1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1,   // Frente
        1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, // Atrás
        0,1,1,1, 0,1,1,1, 0,1,1,1, 0,1,1,1, 0,1,1,1, 0,1,1,1, 0,1,1,1, 0,1,1,1,   // Izq
        1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, // Der
        0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, // Abajo
        0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1,    // Arriba

        //Letra E
        1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1,  // Frente
        1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1, 1,0,1,1,  // Atrás
        0,1,1,1, 0,1,1,1, 0,1,1,1, 0,1,1,1,   // Izq
        1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, 1,0,0,1, // Der
        0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1, 0,0,1,1,  // Abajo
        0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1, 0,1,0,1,    // Arriba

      ];

      let indices=[
        //Letra C
        0,1,2,0,2,3,0,3,7,3,7,4,7,4,5,6,7,5,               //FRENTE 17
        8,9,10,8,10,11,8,11,15,11,15,12,15,12,13,14,15,13, //ATRAS 35
        16,17,18,18,17,19,                                 //IZQ 41
        20,21,22,22,21,23,  24,25,26,26,25,27,  28,29,30,30,29,31, //DER 59 
        32,33,34,34,33,35,  36,37,38,38,37,39,             //ABAJO 71
        40,41,42,42,41,43,  44,45,46,46,45,47,             //ARRIBA 83

        //Letra P
        48,49,54, 49,54,55, 49,55,50, 55,50,56, 56,50,51, 51,56,57, 48,54,53, 52,54,53,     //FRENTE 107
        58,59,64, 59,64,65, 59,65,60, 65,60,66, 66,60,61, 61,66,67, 58,64,63, 62,64,63, //ATRAS 131
        68,69,70,69,70,71,  72,73,74,73,74,75,                              //IZQ  143
        76,77,78,77,78,79,  80,81,82,81,82,83,  84,85,86,85,86,87, //DER 161
        88,89,90,89,90,91,  92,93,94,93,94,95, 96,97,98,97,98,99,            //ABAJO 179
        100,101,102,102,101,103,  104,105,106,106,105,107,             //ARRIBA 191

        //Letra E
        108,109,110,108,110,111,108,111,119,111,119,116,119,116,117,117,118,119, 112,113,115, 113,114,115, //FRENTE 215
        120,121,122,120,122,123,120,123,131,123,131,128,131,128,129,129,130,131, 124,125,127, 125,126,127, //ATRAS 239
        132,133,134,133,134,135,                                 //IZQ    245
        136,137,138,137,138,139,  140,141,142,141,142,143,  144,145,146,145,146,147, 148,149,150,149,150,151, 152,153,154,153,154,155, //DER 265
        156,157,158,157,158,159,  160,161,162,161,162,163,  164,165,166,165,166,167,            //ABAJO 283
        168,169,170,169,170,171,  172,173,174,173,174,175,  176,177,178,177,178,179,            //ARRIBA 0 - 301
      ];

      cuboVAO = gl.createVertexArray();
      gl.bindVertexArray(cuboVAO);

      let vBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER,vBuffer);
      gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW);
      gl.enableVertexAttribArray(0);
      gl.vertexAttribPointer(0,3,gl.FLOAT,false,0,0);

      let cBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER,cBuffer);
      gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(colores),gl.STATIC_DRAW);
      gl.enableVertexAttribArray(1);
      gl.vertexAttribPointer(1,4,gl.FLOAT,false,0,0);

      let iBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,iBuffer);
      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(indices),gl.STATIC_DRAW);

      gl.bindVertexArray(null);

      /* =================== PROYECCIÓN =================== */
      //let aspect = canvas.width / canvas.height;
      //ortho(MatrizProyeccion,-5*aspect,5*aspect,-5,5,-10,10);
      let ancho_division = canvas.width / 3;
      let aspect_tercio = ancho_division / canvas.height; 
      
      // Usamos el aspecto del tercio.
      ortho(MatrizProyeccion,-5*aspect_tercio,5*aspect_tercio,-5,5,-10,10);
      //-----------------------------------------------------------
      gl.uniformMatrix4fv(uMatrizProyeccion,false,MatrizProyeccion);

      identidad(MatrizVista);
      gl.uniformMatrix4fv(uMatrizVista,false,MatrizVista);

      gl.enable(gl.DEPTH_TEST);
      gl.clearColor(0,0,0,1);

      /* ====== LISTENERS DEL MENÚ: ubicados aquí (después de inicializar GL) ====== */
      document.getElementById("selectorLetra").addEventListener("change", (e) => {
        letraObjetivo = e.target.value;
      });

      document.getElementById("selectorAnim").addEventListener("change", (e) => {
        animacion = e.target.value;
      });

      document.getElementById("wireframeBtn").addEventListener("click", () => {
        wireframe = !wireframe;
        document.getElementById("wireframeBtn").innerText = wireframe ? "Esqueleto del diseño ON" : "Esqueleto del diseño OFF";
      });

      dibuja();
    }

    window.onload = main;
  </script>
</body>
</html>
